# sys_dice_inlet_design.md - ダイスインレット設計書

---

## 概要

このドキュメントは、「CardsAndDices」プロジェクトにおけるダイスインレットの技術的な仕様を定義します。
ダイスインレットは、クリーチャーカードに付属し、ダイスを投入することで特定の能力を発動させるためのインタラクティブな要素です。

---

## インレットの基本機能

### 1. ダイス投入による能力発動

プレイヤーは、ダイスをドラッグ＆ドロップすることでインレットに投入します。
インレットは、投入されたダイスが発動条件を満たした場合に、固有の能力を発動します。

### 2. 投入可能なダイスの目の制限

各インレットには、投入を許可するダイスの目のリストが設定されます。
例えば、「偶数のみ」「3以上」といった条件を定義できます。

### 3. カウントダウンによる発動条件

インレットは、能力発動までに必要なカウントダウン値を持ちます。
ダイスが投入されると、その目の数だけカウントダウン値が減少し、0以下になった時点で能力が発動します。

### 4. クールタイム

一度能力が発動したインレットは、特定の期間（例: 1ターン）再発動できなくなるクールタイム状態になります。
クールタイム中のインレットは、視覚的に無効であることがプレイヤーに示されます。

### 5. エネミーインレット

敵クリーチャーのインレットは、プレイヤーがダイスを投入することで、そのターンにおける敵の特定の能力を封じる役割を持ちます。
これは、敵の強力な能力に対する対抗策として機能します。

---

## データ構造とプロパティ

インレットの状態と振る舞いを管理するため、以下のデータ構造を定義します。

`DiceInletData` (ScriptableObjectまたはクラス)

-   `AllowedDiceFaces` (List<int>):
    -   投入を許可するダイスの目のリスト。例: `[2, 4, 6]`
-   `InitialCountdownValue` (int):
    -   発動に必要なカウントダウンの初期値。
-   `CurrentCountdownValue` (int):
    -   現在のカウントダウン値。ダイス投入により減少します。
-   `ActivationType` (InletActivationType):
    -   プレイヤーに提示される発動条件の見た目とロジックを定義するenum。
-   `IsInCooldown` (bool):
    -   クールタイム中かどうかを示すフラグ。

`InletActivationType` (enum)

-   `SingleMatchTrigger`:
    -   特定の目に一致するダイスが投入されたら即座に発動するタイプ。
-   `TotalSumTrigger`:
    -   投入されたダイスの目の合計値がカウントダウン値に達したら発動するタイプ。

---

## 発動条件の種別

### 1. Single Match Trigger

-   **動作ロジック:**
    -   `AllowedDiceFaces` に含まれるいずれかの目のダイスが投入された時点で、即座に能力が発動します。
    -   このタイプの場合、`InitialCountdownValue` は通常1として扱われます。
-   **必要なデータ:**
    -   `AllowedDiceFaces`: 発動トリガーとなる目のリスト。

### 2. Total Sum Trigger

-   **動作ロジック:**
    -   ダイスが投入されるたびに、`CurrentCountdownValue` がその目の数だけ減少します。
    -   `CurrentCountdownValue` が0以下になった時点で、能力が発動します。
    -   UI上では、カウントダウン値が徐々に減っていく様子が視覚的に表現されます。
-   **必要なデータ:**
    -   `AllowedDiceFaces`: 投入可能な目のリスト（通常は全て許可）。
    -   `InitialCountdownValue`: 発動に必要な合計値。

---

## 関連ファイル

-   [gdd_combat_system.md](../gdd/gdd_combat_system.md)
-   [guide_rules.md](../guide/guide_rules.md)
-   [guide_files.md](../guide/guide_files.md)

---

## 更新履歴

-   2025-08-08: 初版 (Gemini - Technical Writer for Game Development)
